id: {{id}}
type: profile

extensions:
  - id: file_discovery
    version: '1.0.0'
  - id: ansible
    version: '1.0.0'

tags: {{tags}}

connections:
  - for_resources: [resource/keystone_config]
    filter_resources: [resource/mariadb]
    mapping:
      ip: db_host
      root_password: db_password
      port: db_port

  - for_resources: [resource/keystone_service]
    filter_resources: [resources/haproxy]
    mapping:
        servers: ip
        ports: admin_port

# NOTE(dshulyak) it is mandatory for some profiles to user graph based
# api to provide order of execution for different events
run:
  - containers.actions.clean_list
  - docker.actions.run
  - mariadb.actions.run
  - mariadb.actions.wait
  - mariadb.actions.users
  - keystone.actions.run
  - haproxy.actions.run
  - containers.actions.ensure

remove:
  - haproxy.actions.remove
  - keystone.actions.remove
  - mariadb.actions.remove
  - docker.actions.remove
