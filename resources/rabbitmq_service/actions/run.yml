- hosts: [{{ ip }}]
  sudo: yes
  tasks:
    - name: rabbitmq container
      docker:
        command: /bin/bash -c rabbitmq-server
        name: {{ container_name }}
        image: {{ image }}
        state: running
        expose:
        - 5672
        - 15672
        ports:
        - {{ port }}:5672
        - {{ management_port }}:15672
        env:
            RABBITMQ_NODENAME: {{container_name}}
    - shell: docker exec -t {{ name }} rabbitmqctl list_users
      register: result
      until: result.rc == 0
      retries: 20
      delay: 0.5
