id: haproxy
class: haproxy
type: resource
handler: ansible
version: v1

actions:
  run: simple/haproxy/run.yml
  remove: simple/haproxy/remove.yml

input:
  name: solar.haproxy-test
  image: 'haproxy:1.5'

  services:
    - service_name: keystone-admin
      bind: '*:8080'
      backends:
        'with_tags': ['service/keystone']
        'item':
          'remote_name': '{{ item.name }}'
          'remote_addr': '{{ item.node.ip }}:{{ item.admin_port }}'

    - service_name: keystone-pub
      bind: '*:8081'
      backends:
        with_tags: ["service/keystone"]
        item:
          remote_name: '{{ item.name }}'
          remote_addr: '{{ item.node.ip }}:{{ item.public_port }}'

tags: [service/haproxy]
